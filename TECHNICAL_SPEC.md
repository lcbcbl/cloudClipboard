# 云剪切板应用技术方案

## 1. 项目概述

云剪切板应用允许用户在不同设备间共享字符串和文件，实现跨设备的数据同步。

## 2. 技术栈

### 2.1 后端
- **语言**: Node.js
- **框架**: Express.js
- **字符串存储**: 内存存储（LRU缓存）
- **文件存储**: 本地文件系统
- **元数据存储**: JSON文件

### 2.2 前端
- **框架**: React 18
- **构建工具**: Vite
- **UI组件库**: Ant Design
- **HTTP客户端**: Axios

## 3. 系统架构

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   前端应用      │     │   后端服务      │     │   存储系统      │
│  (React + Vite) │────▶│  (Express.js)   │────▶│  - 内存缓存     │
└─────────────────┘     └─────────────────┘     │  - 文件系统     │
                                                │  - JSON元数据   │
                                                └─────────────────┘
```

## 4. 核心功能设计

### 4.1 字符串剪切板

#### 4.1.1 存储设计
- 使用LRU（最近最少使用）缓存算法
- 内存总量限制：默认100MB
- 单条字符串大小限制：1MB
- 最大存储数量：1000条

#### 4.1.2 API设计
| 方法 | 路径 | 功能 |
|------|------|------|
| POST | /api/clipboard/text | 上传字符串 |
| GET | /api/clipboard/text | 获取所有字符串（按最近访问排序） |
| GET | /api/clipboard/text/:id | 获取指定字符串 |
| DELETE | /api/clipboard/text/:id | 删除指定字符串 |

### 4.2 文件管理

#### 4.2.1 存储设计
- 文件存储路径：`./uploads/`
- 元数据存储：`./data/files.json`
- 单文件大小限制：默认100MB
- 总存储空间限制：默认10GB
- 传输速度限制：默认1MB/s
- 定期删除：默认7天未访问的文件
- 最大下载次数：默认10次

#### 4.2.2 API设计
| 方法 | 路径 | 功能 |
|------|------|------|
| POST | /api/files | 上传文件 |
| GET | /api/files | 获取所有文件列表 |
| GET | /api/files/:id | 获取文件信息 |
| GET | /api/files/:id/download | 下载文件 |
| DELETE | /api/files/:id | 删除文件 |

## 5. 核心实现细节

### 5.1 LRU缓存实现
- 使用双向链表 + 哈希表实现O(1)时间复杂度的get和put操作
- 当内存超过限制时，自动删除最久未使用的项

### 5.2 文件上传处理
- 使用`multer`中间件处理文件上传
- 实现文件大小限制
- 生成唯一文件ID
- 记录文件元数据（大小、类型、上传时间、下载次数等）

### 5.3 文件下载处理
- 实现下载次数统计
- 实现传输速度限制
- 检查文件是否存在
- 检查下载次数是否超过限制

### 5.4 定期清理机制
- 使用定时器定期检查文件访问时间
- 删除超过7天未访问的文件
- 同时更新元数据

## 6. 项目结构

```
├── backend/                # 后端代码
│   ├── src/
│   │   ├── config/         # 配置文件
│   │   ├── controllers/    # 控制器
│   │   ├── middleware/     # 中间件
│   │   ├── services/       # 业务逻辑
│   │   ├── utils/          # 工具函数
│   │   └── app.js          # 应用入口
│   ├── uploads/            # 文件存储目录
│   ├── data/               # 元数据存储
│   └── package.json
├── frontend/               # 前端代码
│   ├── src/
│   │   ├── components/     # React组件
│   │   ├── hooks/          # 自定义Hooks
│   │   ├── services/       # API服务
│   │   ├── utils/          # 工具函数
│   │   ├── App.jsx         # 应用入口
│   │   └── main.jsx        # 渲染入口
│   └── package.json
└── README.md               # 项目说明
```

## 7. 性能优化

- 使用Gzip压缩静态资源
- 实现文件分片上传（大文件支持）
- 使用CDN加速静态资源访问
- 优化数据库查询（如果使用数据库）

## 8. 安全性考虑

- 实现CORS跨域限制
- 对上传文件进行类型检查
- 防止路径遍历攻击
- 实现请求频率限制
- 对敏感数据进行加密

## 9. 部署方案

- 本地开发：使用Node.js直接运行
- 生产部署：使用PM2管理进程，Nginx作为反向代理

## 10. 监控与日志

- 实现请求日志记录
- 监控系统资源使用情况
- 实现错误日志记录

## 11. 测试计划

- 单元测试：使用Jest测试核心功能
- 集成测试：测试API接口
- 端到端测试：使用Cypress测试完整流程

## 12. 后续扩展

- 支持用户认证
- 支持多用户隔离
- 支持更多文件类型预览
- 支持文件分享链接
- 支持移动端适配
- 支持WebDAV协议
